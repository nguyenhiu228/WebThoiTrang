<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Trang Home - Test JWT</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; }
        form { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
        input { display: block; margin: 5px 0; padding: 8px; width: 100%; }
        button { padding: 8px 15px; margin-top: 10px; }
        .result { border: 1px solid #eee; background: #f9f9f9; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
<h1>Test JWT Spring Security</h1>

<!-- Form Đăng ký -->
<h2>Đăng ký</h2>
<form id="registerForm">
    <input type="text" name="username" placeholder="Tên đăng nhập" required>
    <input type="password" name="password" placeholder="Mật khẩu" required>
    <input type="text" name="fullName" placeholder="Họ tên">
    <input type="email" name="email" placeholder="Email" required>
    <input type="text" name="phone" placeholder="Số điện thoại">
    <input type="text" name="address" placeholder="Địa chỉ">
    <button type="submit">Đăng ký</button>
</form>
<div id="registerResult" class="result"></div>

<!-- Form Đăng nhập -->
<h2>Đăng nhập</h2>
<form id="loginForm">
    <input type="text" name="username" placeholder="Tên đăng nhập" required>
    <input type="password" name="password" placeholder="Mật khẩu" required>
    <button type="submit">Đăng nhập</button>
</form>
<div id="loginResult" class="result"></div>

<!-- Gọi API test phân quyền -->
<h2>Test API bảo vệ bằng JWT</h2>
<button id="userHelloBtn">Gọi /api/user/hello</button>
<button id="adminHelloBtn">Gọi /api/admin/hello</button>
<div id="apiResult" class="result"></div>

<script>
    let jwtToken = null;

    // Xử lý đăng ký
    document.getElementById("registerForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this).entries());

        fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
            .then(res => {
                if (!res.ok) throw new Error("Lỗi đăng ký");
                return res.text();
            })
            .then(msg => {
                document.getElementById("registerResult").innerText = "✅ " + msg;
            })
            .catch(err => {
                document.getElementById("registerResult").innerText = "❌ " + err;
            });
    });

    // Xử lý đăng nhập
    document.getElementById("loginForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(this).entries());

        fetch("/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
            .then(res => res.json())
            .then(json => {
                jwtToken = json.token;
                document.getElementById("loginResult").innerText = "✅ Đăng nhập thành công!\nToken: " + jwtToken;
            })
            .catch(err => {
                document.getElementById("loginResult").innerText = "❌ " + err;
            });
    });

    // Test API USER
    document.getElementById("userHelloBtn").addEventListener("click", function () {
        fetch("/api/user/hello", {
            headers: { "Authorization": "Bearer " + jwtToken }
        })
            .then(res => res.text())
            .then(text => {
                document.getElementById("apiResult").innerText = "USER API: " + text;
            })
            .catch(err => {
                document.getElementById("apiResult").innerText = "❌ " + err;
            });
    });

    // Test API ADMIN
    document.getElementById("adminHelloBtn").addEventListener("click", function () {
        fetch("/api/admin/hello", {
            headers: { "Authorization": "Bearer " + jwtToken }
        })
            .then(res => res.text())
            .then(text => {
                document.getElementById("apiResult").innerText = "ADMIN API: " + text;
            })
            .catch(err => {
                document.getElementById("apiResult").innerText = "❌ " + err;
            });
    });
</script>

</body>
</html>
